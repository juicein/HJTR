<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>åŠ è½½ä¸­...</title>

  <!-- é»˜è®¤ OG æ ‡ç­¾ -->
  <meta property="og:title" content="åŠ è½½ä¸­..." />
  <meta property="og:description" content="æ­£åœ¨åŠ è½½æ–°é—»..." />
  <meta property="og:image" content="" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="" />

  <!-- æ ·å¼ -->
  <link rel="stylesheet" href="../assets/style.css" />
  <style>
    body {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 15px;
      font-family: "å¾®è½¯é›…é»‘", sans-serif;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #0077cc;
      text-decoration: none;
    }
    .news-title {
      font-size: 2em;
      margin-bottom: 10px;
    }
    .news-meta {
      color: #666;
      margin-bottom: 10px;
    }
    .view-count {
      color: #999;
      font-size: 0.9em;
      margin-bottom: 20px;
    }
    .news-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 20px;
      display: block;
    }
    .news-content {
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 1.1em;
    }
    /* åˆ†äº«æŒ‰é’®æ ·å¼ */
    .share-container {
      margin-top: 40px;
      border-top: 1px solid #eee;
      padding-top: 15px;
    }
    .share-title {
      margin-bottom: 10px;
      font-weight: bold;
    }
    .share-buttons a {
      display: inline-block;
      margin-right: 10px;
      text-decoration: none;
      color: #fff;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 0.9em;
    }
    .share-weibo { background: #E6162D; }
    .share-twitter { background: #1DA1F2; }
    .share-facebook { background: #4267B2; }
    .share-qq { background: #12B7F5; }
    .share-wechat { background: #1AAD19; }

    /* å¾®ä¿¡å¼¹çª— */
    #wechat-popup {
      display:none;
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.6);
      justify-content:center;
      align-items:center;
      z-index: 9999;
    }
    #wechat-popup .popup-content {
      background:#fff;
      padding:20px;
      border-radius:8px;
      text-align:center;
    }
    #wechat-popup button {
      margin-top:10px;
      padding:6px 12px;
      background:#666;
      color:#fff;
      border:none;
      border-radius:4px;
      cursor:pointer;
    }
  </style>

  <!-- å¼•å…¥äºŒç»´ç åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
</head>
<body>
  <a href="../index.html" class="back-link">â† è¿”å›æ–°é—»åˆ—è¡¨</a>

  <h1 id="title" class="news-title">åŠ è½½ä¸­...</h1>
  <div id="meta" class="news-meta"></div>
  <div id="views" class="view-count"></div> <!-- æµè§ˆé‡æ˜¾ç¤º -->
  <img id="image" class="news-image" src="" alt="" style="display:none" />
  <div id="content" class="news-content"></div>

  <!-- åˆ†äº«åŒº -->
  <div class="share-container">
    <div class="share-title">ğŸ“¢ åˆ†äº«åˆ°ï¼š</div>
    <div class="share-buttons">
      <a id="share-weibo" class="share-weibo" target="_blank">å¾®åš</a>
      <a id="share-twitter" class="share-twitter" target="_blank">Twitter</a>
      <a id="share-facebook" class="share-facebook" target="_blank">Facebook</a>
      <a id="share-qq" class="share-qq" target="_blank">QQ</a>
      <a id="share-wechat" class="share-wechat">å¾®ä¿¡</a>
    </div>
  </div>

  <!-- å¾®ä¿¡äºŒç»´ç å¼¹çª— -->
  <div id="wechat-popup">
    <div class="popup-content">
      <p style="margin-bottom:10px; font-weight:bold;">ğŸ“± æ‰«ç åˆ†äº«åˆ°å¾®ä¿¡</p>
      <canvas id="wechat-qrcode"></canvas>
      <br />
      <button onclick="document.getElementById('wechat-popup').style.display='none'">å…³é—­</button>
    </div>
  </div>

  <script>
    function getQueryId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    const newsId = getQueryId();

    if (newsId === null) {
      document.getElementById('title').textContent = 'é”™è¯¯ï¼šæœªæŒ‡å®šæ–°é—»ID';
    } else {
      fetch('../news_content.json')
        .then(res => res.json())
        .then(news => {
          if (newsId < 0 || newsId >= news.length) {
            document.getElementById('title').textContent = 'æ–°é—»ä¸å­˜åœ¨';
            return;
          }
          const item = news[newsId];

          // è®¾ç½®é¡µé¢æ ‡é¢˜
          document.title = item.title;

          // è®¾ç½® OG æ ‡ç­¾
          document.querySelector('meta[property="og:title"]').setAttribute('content', item.title);
          document.querySelector('meta[property="og:description"]').setAttribute('content', item.content.substring(0, 80) + "...");
          if (item.image && item.image.trim() !== '') {
            document.querySelector('meta[property="og:image"]').setAttribute('content', item.image);
          }
          document.querySelector('meta[property="og:url"]').setAttribute('content', window.location.href);

          // å¡«å……æ­£æ–‡
          document.getElementById('title').textContent = item.title;
          document.getElementById('meta').textContent = `${item.date} Â· ${item.location} Â· ä½œè€…ï¼š${item.author}`;

          if (item.image && item.image.trim() !== '') {
            const img = document.getElementById('image');
            if (item.image.startsWith('#')) {
              img.style.display = 'none';
              const colorDiv = document.createElement('div');
              colorDiv.style.width = '100%';
              colorDiv.style.height = '200px';
              colorDiv.style.backgroundColor = item.image;
              colorDiv.style.borderRadius = '8px';
              colorDiv.style.marginBottom = '20px';
              img.parentNode.insertBefore(colorDiv, img);
            } else {
              img.src = item.image;
              img.style.display = 'block';
            }
          }

          document.getElementById('content').textContent = item.content;

          /* ğŸ“Š æµè§ˆé‡ç»Ÿè®¡ï¼ˆLocalStorage å®ç°ï¼‰ */
          let viewsKey = "views_" + newsId;
          let count = localStorage.getItem(viewsKey) || 0;
          count++;
          localStorage.setItem(viewsKey, count);
          document.getElementById('views').textContent = `ğŸ‘ï¸ æµè§ˆé‡ï¼š${count}`;

          /* ğŸ”— è®¾ç½®åˆ†äº«é“¾æ¥ */
          const url = encodeURIComponent(window.location.href);
          const text = encodeURIComponent(item.title);

          document.getElementById("share-weibo").href =
            `https://service.weibo.com/share/share.php?title=${text}&url=${url}`;
          document.getElementById("share-twitter").href =
            `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
          document.getElementById("share-facebook").href =
            `https://www.facebook.com/sharer/sharer.php?u=${url}`;
          document.getElementById("share-qq").href =
            `https://connect.qq.com/widget/shareqq/index.html?url=${url}&title=${text}&desc=${text}&pics=${encodeURIComponent(item.image || '')}`;

          /* å¾®ä¿¡åˆ†äº«ï¼ˆäºŒç»´ç å¼¹çª—ï¼‰ */
          document.getElementById("share-wechat").addEventListener("click", function() {
            const popup = document.getElementById("wechat-popup");
            popup.style.display = "flex";

            // ç”ŸæˆäºŒç»´ç 
            const canvas = document.getElementById("wechat-qrcode");
            canvas.innerHTML = ""; // æ¸…ç©º
            new QRious({
              element: canvas,
              value: window.location.href,
              size: 200
            });
          });
        })
        .catch(() => {
          document.getElementById('title').textContent = 'åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
        });
    }
  </script>
</body>
</html>
