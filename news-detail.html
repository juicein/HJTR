<!DOCTYPE html>
<html lang="zh">
<head>
  <!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>加载中...</title>

  <!-- 默认 OG 标签（JS 加载后会替换） -->
  <meta property="og:title" content="加载中..." />
  <meta property="og:description" content="正在加载新闻..." />
  <meta property="og:image" content="" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="" />

  <link rel="stylesheet" href="../assets/style.css" />
  <style>
    body {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 15px;
      font-family: "微软雅黑", sans-serif;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #0077cc;
      text-decoration: none;
    }
    .news-title {
      font-size: 2em;
      margin-bottom: 10px;
    }
    .news-meta {
      color: #666;
      margin-bottom: 20px;
    }
    .news-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 20px;
      display: block;
    }
    .news-content {
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <a href="../index.html" class="back-link">← 返回新闻列表</a>

  <h1 id="title" class="news-title">加载中...</h1>
  <div id="meta" class="news-meta"></div>
  <img id="image" class="news-image" src="" alt="" style="display:none" />
  <div id="content" class="news-content"></div>

  <script>
    function getQueryId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    const newsId = getQueryId();

    if (newsId === null) {
      document.getElementById('title').textContent = '错误：未指定新闻ID';
    } else {
      fetch('../news_content.json')
        .then(res => res.json())
        .then(news => {
          if (newsId < 0 || newsId >= news.length) {
            document.getElementById('title').textContent = '新闻不存在';
            return;
          }
          const item = news[newsId];

          // 设置页面标题
          document.title = item.title;

          // 设置 OG 标签（QQ/微信抓取）
          document.querySelector('meta[property="og:title"]').setAttribute('content', item.title);
          document.querySelector('meta[property="og:description"]').setAttribute('content', item.content.substring(0, 80) + "...");
          if (item.image && item.image.trim() !== '') {
            document.querySelector('meta[property="og:image"]').setAttribute('content', item.image);
          }
          document.querySelector('meta[property="og:url"]').setAttribute('content', window.location.href);

          // 填充正文
          document.getElementById('title').textContent = item.title;
          document.getElementById('meta').textContent = `${item.date} · ${item.location} · 作者：${item.author}`;

          if (item.image && item.image.trim() !== '') {
            const img = document.getElementById('image');
            if (item.image.startsWith('#')) {
              img.style.display = 'none';
              const colorDiv = document.createElement('div');
              colorDiv.style.width = '100%';
              colorDiv.style.height = '200px';
              colorDiv.style.backgroundColor = item.image;
              colorDiv.style.borderRadius = '8px';
              colorDiv.style.marginBottom = '20px';
              img.parentNode.insertBefore(colorDiv, img);
            } else {
              img.src = item.image;
              img.style.display = 'block';
            }
          }

          document.getElementById('content').textContent = item.content;
        })
        .catch(() => {
          document.getElementById('title').textContent = '加载失败，请稍后重试';
        });
    }
  </script>
</body>
</html>
